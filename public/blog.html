<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/dist/styles.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200..800&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
          rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
<div class="site-wrapper">
    <header id="header-placeholder" class="site-header"></header>
    <main class="site-main">
        <div class="site-main__content site-main__content--landing">
            <section class="block-main-article-section">
                <h1 class="blog__title mb-10">Insights From <span class="blog__title--purple">Our Blog</span></h1>

                <div class="block-main-article-section__wrapper flex flex-col lg:flex-row gap-12">

                    <div class="block-main-article-section__content flex flex-col w-full">

                        <div class="block-main-article-section__tag-block tag-block mb-4">
                            Tag name
                        </div>

                        <h2 class="block-main-article-section__title mb-6">
                            Heading text
                        </h2>

                        <p class="block-main-article-section__description mb-6">
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed sit amet justo ipsum. Sed
                            accumsan quam vitae est varius fringilla. Pellentesque placerat vestibulum lorem sed porta.
                            Nullam mattis tristique iaculis. Nullam pulvinar sit amet risus pretium auctor. Etiam quis
                            massa pulvinar, aliquam quam vitae, tempus sem. Donec elementum pulvinar odio.
                        </p>

                        <a href="#" class="block-main-article-section__read-more read-more-btn">
                            <span>Read more</span>
                            <svg width="5" height="10" viewBox="0 0 20 20" fill="none"
                                 xmlns="http://www.w3.org/2000/svg">
                                <path d="M7.5 15L12.5 10L7.5 5" stroke="white" stroke-width="2"/>
                            </svg>
                        </a>
                    </div>

                    <div class="block-main-article-section__image-wrapper flex w-full">
                        <div class="block-main-article-section__image">
                            <img src="images/blog/blog-main-image.png" alt="blog image"/>
                        </div>
                    </div>

                </div>
            </section>


        </div>
    </main>

    <footer class="site-footer" id="footer-placeholder"></footer>
</div>
</body>
</html>
<script src="main.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        fetch('/header.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('header-placeholder').innerHTML = html;
                initHeader();
            });

        fetch('/footer.html')
            .then(res => res.text())
            .then(data => document.getElementById('footer-placeholder').innerHTML = data);

        fetch('/components/contact-us-modal.html')
            .then(res => res.text())
            .then(html => {
                document.body.insertAdjacentHTML('beforeend', html);
                const modal = document.getElementById('contactUsModal');
                if (!modal) return;

                modal.addEventListener('click', (e) => {
                    if (e.target === modal) openModal(false);
                });

                const container = modal.querySelector('.contactUsModal__container');
                if (container) container.addEventListener('click', (e) => e.stopPropagation());
            });

        // Init Testimonial Carousel
        initTestimonialCarousel();
        // Init Testimonial Modal
        initTestimonialModal();
        // Init Video Play
        initVideoPlay();
    });

    function openModal(show) {
        const modal = document.getElementById('contactUsModal');

        if (show) {
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        } else {
            modal.classList.add('hidden');
            modal.classList.add('flex');
        }
    }

    function initTestimonialCarousel() {
        const container = document.querySelector('.testimonials__items');
        const btnPrev = document.querySelector('.btn__prev');
        const btnNext = document.querySelector('.btn__next');
        const pageNumberEl = document.querySelector('.testimonials__pagination-buttons-number');

        if (!container || !btnPrev || !btnNext || !pageNumberEl) return;

        const items = Array.from(container.querySelectorAll('.testimonials__items-item'));

        // Get the element width with gap
        const getItemFullWidth = () => {
            const gap = parseFloat(getComputedStyle(container).gap) || 0;
            return items[0].offsetWidth + gap;
        };

        // How many cards are visible at once
        const getItemsPerView = () => {
            const itemWidth = items[0].offsetWidth;
            return Math.max(1, Math.round(container.offsetWidth / itemWidth));
        };

        // How many total pages
        const getTotalPages = () => {
            const totalItems = items.length;
            const perView = getItemsPerView();
            return Math.ceil(totalItems / perView);
        };

        // Current page based on scrollLeft position
        const getCurrentPage = () => {
            const scrollLeft = container.scrollLeft;
            const fullWidth = getItemFullWidth();
            const perView = getItemsPerView();
            const totalPages = getTotalPages();

            // first visible card index
            const firstVisibleIndex = Math.round(scrollLeft / fullWidth);

            // calculating page
            let currentPage = Math.floor(firstVisibleIndex / perView) + 1;

            // if scrolling is at the end (on an incomplete page) â€” show the last
            const maxScroll = container.scrollWidth - container.clientWidth - 5;
            if (scrollLeft >= maxScroll) {
                currentPage = totalPages;
            }

            return Math.min(Math.max(currentPage, 1), totalPages);
        };

        // Page transition
        const goToPage = (pageIndex) => {
            const fullWidth = getItemFullWidth();
            const perView = getItemsPerView();

            const targetScroll = fullWidth * perView * (pageIndex - 1);

            container.scrollTo({
                left: targetScroll,
                behavior: 'smooth',
            });

            // Update UI after scrolling animation
            setTimeout(updatePageNumber, 400);
        };

        // UI Update and forced Reflow
        const updatePageNumber = () => {
            const currentPage = getCurrentPage();
            const totalPages = getTotalPages();
            pageNumberEl.textContent = `${currentPage}/${totalPages}`;

            // block the buttons at the ends
            btnPrev.disabled = currentPage === 1;
            btnNext.disabled = currentPage === totalPages;

            // Toggle active classes
            if (currentPage > 1) {
                btnPrev.classList.add('btn__prev--active');
            } else {
                btnPrev.classList.remove('btn__prev--active');
            }

            if (currentPage < totalPages) {
                btnNext.classList.add('btn__next--active');
            } else {
                btnNext.classList.remove('btn__next--active');
            }

            // Forced reflow fix
            const originalJustify = container.style.justifyContent;
            container.style.justifyContent = 'space-between';
            container.offsetHeight;
            container.style.justifyContent = originalJustify || 'left';
        };

        // Navigation
        btnNext.addEventListener('click', () => {
            const [current, total] = pageNumberEl.textContent.split('/').map(Number);
            if (current < total) goToPage(current + 1);
        });

        btnPrev.addEventListener('click', () => {
            const [current] = pageNumberEl.textContent.split('/').map(Number);
            if (current > 1) goToPage(current - 1);
        });

        // Update on manual scroll
        let scrollTimeout;
        container.addEventListener('scroll', () => {
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(updatePageNumber, 100);
        });

        // When resizing the screen
        window.addEventListener('resize', () => {
            setTimeout(() => {
                updatePageNumber();
                // Scroll to the start of the current page after resize to prevent awkward partial views
                const currentPage = getCurrentPage();
                goToPage(currentPage);
            }, 300);
        });

        // Initialization
        updatePageNumber();
    }

    function initTestimonialModal() {
        const modal = document.getElementById("testimonialModal");
        const modalContent = document.getElementById("modalContent");
        const closeModal = document.getElementById("closeModal");

        const modalAvatar = document.getElementById("modalAvatar");
        const modalName = document.getElementById("modalName");
        const modalCompany = document.getElementById("modalCompany");
        const modalRating = document.getElementById("modalRating");

        // Modal opening
        document.querySelectorAll(".btn__read-more").forEach((btn) => {
            btn.addEventListener("click", () => {
                const item = btn.closest(".testimonials__items-item");
                const avatar = item.querySelector(".testimonials__items-item-text-main-avatar img").src;
                const name = item.querySelector(".testimonials__items-item-text-main-title-block-name").textContent;
                const company = item.querySelector(".testimonials__items-item-text-main-title-block-company").textContent;
                const text = btn.getAttribute("data-modal-text");

                const stars = item.querySelectorAll(".testimonials__items-item-rating-marks-star img");
                modalRating.innerHTML = "";
                stars.forEach(star => {
                    const clone = star.cloneNode(true);
                    clone.classList.add("w-4", "h-4", "mr-1");
                    modalRating.appendChild(clone);
                });

                // Filling the modal
                modalAvatar.src = avatar;
                modalName.textContent = name;
                modalCompany.textContent = company;
                modalContent.textContent = text;

                modal.classList.remove("hidden");
                modal.classList.add("flex");
            });
        });

        // Closing
        closeModal.addEventListener("click", () => {
            modal.classList.add("hidden");
            modal.classList.remove("flex");
        });

        // Click outside modal
        modal.addEventListener("click", (e) => {
            if (e.target === modal) {
                modal.classList.add("hidden");
                modal.classList.remove("flex");
            }
        });
    }

    function initVideoPlay() {
        const videoContainers = document.querySelectorAll('.process-in-actions__video-item-video');

        videoContainers.forEach(container => {
            const playButton = container.querySelector('.video-play-btn');
            const video = container.querySelector('video');

            if (playButton && video) {
                playButton.addEventListener('click', () => {
                    playButton.classList.add('hidden');
                    video.play();
                });

                video.addEventListener('ended', () => {
                    playButton.classList.remove('hidden');
                });
            }
        });
    }
</script>